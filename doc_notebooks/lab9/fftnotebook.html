

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Introduction &mdash; Numeric course 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Numeric course
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../course_bootstrap.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ugradsyllabus20.html">Undergrad Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gradsyllabus20.html">Grad Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schedule20.html">Detailed Schedule</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../texts.html">Optional texts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebook_toc.html">Course/lab descriptions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Numeric course</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/doc_notebooks/lab9/fftnotebook.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<h1><p>Table of Contents</p>
</h1><div class="toc" style="margin-top: 1em;"><ul class="toc-item"><li><p>1  Introduction</p>
<ul class="toc-item"><li><p>1.1  A simple transform</p>
</li><li><p>1.2  Power spectrum of turbulent vertical velocity</p>
</li><li><p>1.3  power spectrum layout</p>
<ul class="toc-item"><li><p>1.3.1  Confirm that the fft at negative f is the complex conjugate of the fft at positive f</p>
</li></ul></li><li><p>1.4  Windowing</p>
</li><li><p>1.5  Compare power spectra for wvel, theta, sensible heat flux</p>
<ul class="toc-item"><li><p>1.5.1  start with wvel</p>
</li></ul></li><li><p>1.6  Filtering</p>
</li></ul></li></ul></div><div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="Introduction">
<h1>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h1>
<p>This lab introduces the use of the fast Fourier transform for estimation of the power spectral density and for simple filtering. If you need a refresher or are learning about fourier transforms for the first time, we recommend reading <a class="reference external" href="http://clouds.eos.ubc.ca/~phil/docs/atsc500/pdf_files/newman_chapter7.pdf">Newman Chapter 7</a>. For a description of the Fast Fourier transform, see <a class="reference external" href="http://clouds.eos.ubc.ca/~phil/docs/atsc500/pdf_files/stull_section8_4.pdf">Stull Section 8.4</a> and <a class="reference external" href="https://jakevdp.github.io/blog/2013/08/28/understanding-the-fft/">Jake
VanderPlas’s blog entry</a>. Another good resources is <a class="reference external" href="http://clouds.eos.ubc.ca/~phil/docs/atsc500/pdf_files/numerical_recipes_fft.pdf">Numerical Recipes Chapter 12</a> (user: green, password: house)</p>
<div class="section" id="A-simple-transform">
<h2>A simple transform<a class="headerlink" href="#A-simple-transform" title="Permalink to this headline">¶</a></h2>
<p>To get started assume that there is a pure tone – a cosine wave oscillating at a frequency of 1 Hz. Next assume that we sample that 1 Hz wave at a sampling rate of 5 Hz i.e. 5 times a second</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="c1">#</span>
<span class="c1"># create a cosine wave that oscilates 20 times in 20 seconds</span>
<span class="c1"># sampled at  Hz, so there are 20*5 = 100 measurements in 20 seconds</span>
<span class="c1">#</span>
<span class="n">deltaT</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="n">deltaT</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1">#20 cycles in 20 seconds, each cycle goes through 2*pi radians</span>
<span class="c1">#</span>
<span class="n">onehz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ticks</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span><span class="n">onehz</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;one hz wave sampled at 5 Hz&#39;</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (seconds)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/doc_notebooks_lab9_fftnotebook_3_0.png" src="../../_images/doc_notebooks_lab9_fftnotebook_3_0.png" />
</div>
</div>
<p>Repeat, but for a 2 Hz wave</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">deltaT</span><span class="o">=</span><span class="mf">0.2</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="n">deltaT</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1">#40 cycles in 20 seconds, each cycle goes through 2*pi radians</span>
<span class="c1">#</span>
<span class="n">twohz</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ticks</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span><span class="n">twohz</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;two hz wave sampled at 5 Hz&#39;</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time (seconds)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/doc_notebooks_lab9_fftnotebook_5_0.png" src="../../_images/doc_notebooks_lab9_fftnotebook_5_0.png" />
</div>
</div>
<p>Note the problem at 2 Hz, the 5 Hz sampling frequency is too coarse to hit the top of every other peak in the wave</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#now take the fft, we have 100 bins, so we alias at 50 bins, which is the nyquist frequency of 5 Hz/2. = 2.5 Hz</span>
<span class="c1"># so the fft frequency resolution is 20 bins/Hz, or 1 bin = 0.05 Hz</span>
<span class="n">thefft</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">onehz</span><span class="p">)</span>
<span class="n">real_coeffs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">thefft</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real_coeffs</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;real fft of onehz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/doc_notebooks_lab9_fftnotebook_7_0.png" src="../../_images/doc_notebooks_lab9_fftnotebook_7_0.png" />
</div>
</div>
<p>The layout of the fft return value is describe in <a class="reference external" href="http://docs.scipy.org/doc/scipy/reference/tutorial/fftpack.html#id9">the scipy user manual</a>. For reference, here is the Fourier transform calculated by numpy.fft:</p>
<div class="math notranslate nohighlight">
\[y[k] = \sum_{n=0}^{N-1} x[n]\exp \left (- i 2 \pi k n /N \right )\]</div>
<p>which is the discrete version of the continuous transform (Numerical Recipes 12.0.4):</p>
<div class="math notranslate nohighlight">
\[y(k) = \int_{-\infty}^{\infty} x(t) \exp \left ( -i k t \right ) dt\]</div>
<p>(Note the different minus sign convention in the exponent compared to Numerical Recipes p. 490. It doesn’t matter what you choose, as long as you’re consistent).</p>
<p>From the Scipy manual:</p>
<blockquote>
<div><p>Inserting k=0 we see that np.sum(x) corresponds to y[0]. This term will be non-zero if we haven’t removed any large scale trend in the data. For N even, the elements y[1]…y[N/2−1] contain the positive-frequency terms, and the elements y[N/2]…y[N−1] contain the negative-frequency terms, in order of decreasingly negative frequency. For N odd, the elements y[1]…y[(N−1)/2] contain the positive- frequency terms, and the elements y[(N+1)/2]…y[N−1] contain the negative- frequency terms, in order of
decreasingly negative frequency. In case the sequence x is real-valued, the values of y[n] for positive frequencies is the conjugate of the values y[n] for negative frequencies (because the spectrum is symmetric). Typically, only the FFT corresponding to positive frequencies is plotted.</p>
</div></blockquote>
<p>So the first peak at index 20 is (20 bins) x (0.05 Hz/bin) = 1 Hz, as expected. The nyquist frequency of 2.5 Hz is at an index of N/2 = 50 and the negative frequency peak is 20 bins to the left of the end bin.</p>
<p>The inverse transform is:</p>
<div class="math notranslate nohighlight">
\[x[n] = \frac{1}{N} \sum_{k=0}^{N-1} y]k]\exp \left ( i 2 \pi k n /N \right )\]</div>
<p>What about the imaginary part? All imaginary coefficients are zero (neglecting roundoff errors)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">imag_coeffs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">thefft</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">imag_coeffs</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;imag fft of onehz&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/doc_notebooks_lab9_fftnotebook_10_0.png" src="../../_images/doc_notebooks_lab9_fftnotebook_10_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#now evaluate the power spectrum using Stull&#39;s 8.6.1a on p. 312</span>

<span class="n">Power</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">thefft</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">thefft</span><span class="p">))</span>
<span class="n">totsize</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">thefft</span><span class="p">)</span>
<span class="n">halfpoint</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">totsize</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
<span class="n">firsthalf</span><span class="o">=</span><span class="n">Power</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">halfpoint</span><span class="p">]</span>


<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">5.</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">freq</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">halfpoint</span><span class="p">],</span><span class="n">firsthalf</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;power spectrum&#39;</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;frequency (Hz)&#39;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
100
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/doc_notebooks_lab9_fftnotebook_11_1.png" src="../../_images/doc_notebooks_lab9_fftnotebook_11_1.png" />
</div>
</div>
<p>Check Stull 8.6.1b (or Numerical Recipes 12.0.13) which says that squared power spectrum = variance</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">simple cosine: velocity variance </span><span class="si">%10.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">onehz</span><span class="o">*</span><span class="n">onehz</span><span class="p">)</span><span class="o">/</span><span class="n">totsize</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;simple cosine: Power spectrum sum </span><span class="si">%10.3f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Power</span><span class="p">)</span><span class="o">/</span><span class="n">totsize</span><span class="o">**</span><span class="mf">2.</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

simple cosine: velocity variance      0.500
simple cosine: Power spectrum sum      0.500

</pre></div></div>
</div>
</div>
<div class="section" id="Power-spectrum-of-turbulent-vertical-velocity">
<h2>Power spectrum of turbulent vertical velocity<a class="headerlink" href="#Power-spectrum-of-turbulent-vertical-velocity" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#load data sampled at 20.8333 Hz</span>

<span class="n">td</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;miami_tower.npz&#39;</span><span class="p">)</span> <span class="c1">#load temp, uvel, vvel, wvel, minutes</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;keys: &#39;</span><span class="p">,</span><span class="n">td</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">td</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-8-5f80d41902e4&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-red-fg">#load data sampled at 20.8333 Hz</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span>
<span class="ansi-green-fg">----&gt; 3</span><span class="ansi-red-fg"> </span>td<span class="ansi-blue-fg">=</span>numpy<span class="ansi-blue-fg">.</span>load<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;miami_tower.npz&#39;</span><span class="ansi-blue-fg">)</span> <span class="ansi-red-fg">#load temp, uvel, vvel, wvel, minutes</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;keys: &#39;</span><span class="ansi-blue-fg">,</span>td<span class="ansi-blue-fg">.</span>keys<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> print<span class="ansi-blue-fg">(</span>td<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;description&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;numpy&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sampleRate</span><span class="o">=</span><span class="mf">20.833</span>
<span class="n">nyquistfreq</span><span class="o">=</span><span class="n">sampleRate</span><span class="o">/</span><span class="mf">2.</span>


<span class="n">totsize</span><span class="o">=</span><span class="mi">36000</span>
<span class="n">wvel</span><span class="o">=</span><span class="n">td</span><span class="p">[</span><span class="s1">&#39;wvel&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">totsize</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">temp</span><span class="o">=</span><span class="n">td</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="n">totsize</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">wvel</span> <span class="o">=</span> <span class="n">wvel</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wvel</span><span class="p">)</span>
<span class="n">temp</span><span class="o">=</span> <span class="n">temp</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
<span class="n">flux</span><span class="o">=</span><span class="n">wvel</span><span class="o">*</span><span class="n">temp</span>


<span class="n">halfpoint</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">totsize</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
<span class="n">frequencies</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">halfpoint</span><span class="p">)</span>
<span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="o">/</span><span class="n">halfpoint</span>
<span class="n">frequencies</span><span class="o">=</span><span class="n">frequencies</span><span class="o">*</span><span class="n">nyquistfreq</span>

<span class="c1"># raw spectrum -- no windowing or averaging</span>
<span class="c1">#First confirm Parseval&#39;s theorem</span>
<span class="c1"># (Numerical Recipes 12.1.10, p. 498)</span>

<span class="n">thefft</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">wvel</span><span class="p">)</span>
<span class="n">Power</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">thefft</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">thefft</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;check Wiener-Khichine theorem for wvel&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">raw fft sum, full time series: </span><span class="si">%10.4f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Power</span><span class="p">)</span><span class="o">/</span><span class="n">totsize</span><span class="o">**</span><span class="mf">2.</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;velocity variance: </span><span class="si">%10.4f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">wvel</span><span class="o">*</span><span class="n">wvel</span><span class="p">)</span><span class="o">/</span><span class="n">totsize</span><span class="p">))</span>


<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">frequencies</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
<span class="n">Power</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
<span class="n">Power_half</span><span class="o">=</span><span class="n">Power</span><span class="p">[:</span><span class="n">halfpoint</span><span class="p">:]</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span><span class="n">Power_half</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;raw wvel spectrum with $f^{-5/3}$&#39;</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;frequency (HZ)&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Power (m^2/s^2)&#39;</span><span class="p">)</span>
<span class="c1">#</span>
<span class="c1"># pick one point the line should pass through (by eye)</span>
<span class="c1"># note that y intercept will be at log10(freq)=0</span>
<span class="c1"># or freq=1 Hz</span>
<span class="c1">#</span>
<span class="n">leftspec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Power</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.e-3</span><span class="p">)</span>
<span class="n">logy</span><span class="o">=</span><span class="n">leftspec</span> <span class="o">-</span> <span class="mf">5.</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>
<span class="n">yvals</span><span class="o">=</span><span class="mf">10.</span><span class="o">**</span><span class="n">logy</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span><span class="n">yvals</span><span class="p">,</span><span class="s1">&#39;r-&#39;</span><span class="p">)</span>
<span class="n">thePoint</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="n">Power</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">1.e-3</span><span class="p">,</span><span class="s1">&#39;g+&#39;</span><span class="p">)</span>
<span class="n">thePoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_markersize</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">thePoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_marker</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>
<span class="n">thePoint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_markerfacecolor</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-9-063bfe0d8a7d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> totsize<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">36000</span>
<span class="ansi-green-fg">----&gt; 6</span><span class="ansi-red-fg"> </span>wvel<span class="ansi-blue-fg">=</span>td<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;wvel&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>totsize<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>flatten<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      7</span> temp<span class="ansi-blue-fg">=</span>td<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;temp&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>totsize<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>flatten<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> wvel <span class="ansi-blue-fg">=</span> wvel <span class="ansi-blue-fg">-</span> np<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span>wvel<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;td&#39; is not defined
</pre></div></div>
</div>
</div>
<div class="section" id="power-spectrum-layout">
<h2>power spectrum layout<a class="headerlink" href="#power-spectrum-layout" title="Permalink to this headline">¶</a></h2>
<p>Here is what the entire power spectrum looks like, showing positive and negative frequencies</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">Power</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/doc_notebooks_lab9_fftnotebook_19_0.png" src="../../_images/doc_notebooks_lab9_fftnotebook_19_0.png" />
</div>
</div>
<p>and here is what fftshift does:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">shift_power</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">Power</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">shift_power</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/doc_notebooks_lab9_fftnotebook_21_0.png" src="../../_images/doc_notebooks_lab9_fftnotebook_21_0.png" />
</div>
</div>
<div class="section" id="Confirm-that-the-fft-at-negative-f-is-the-complex-conjugate-of-the-fft-at-positive-f">
<h3>Confirm that the fft at negative f is the complex conjugate of the fft at positive f<a class="headerlink" href="#Confirm-that-the-fft-at-negative-f-is-the-complex-conjugate-of-the-fft-at-positive-f" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">test_fft</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">wvel</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">theAx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">test_fft</span><span class="p">))</span>
<span class="n">theAx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">test_fft</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_fft</span><span class="p">[</span><span class="mi">100</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_fft</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-12-9609502a6f5b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>test_fft<span class="ansi-blue-fg">=</span>np<span class="ansi-blue-fg">.</span>fft<span class="ansi-blue-fg">.</span>fft<span class="ansi-blue-fg">(</span>wvel<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> fig<span class="ansi-blue-fg">,</span>theAx<span class="ansi-blue-fg">=</span>plt<span class="ansi-blue-fg">.</span>subplots<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span>figsize<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">8</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> theAx<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>semilogy<span class="ansi-blue-fg">(</span>np<span class="ansi-blue-fg">.</span>real<span class="ansi-blue-fg">(</span>test_fft<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> theAx<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>semilogy<span class="ansi-blue-fg">(</span>np<span class="ansi-blue-fg">.</span>imag<span class="ansi-blue-fg">(</span>test_fft<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> print<span class="ansi-blue-fg">(</span>test_fft<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">100</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;wvel&#39; is not defined
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Windowing">
<h2>Windowing<a class="headerlink" href="#Windowing" title="Permalink to this headline">¶</a></h2>
<p>The FFT above is noisy, and there are several ways to smooth it. Numerical Recipes, p. 550 has a good discussion of “windowing” which helps remove the spurious power caused by the fact that the timeseries has a sudden stop and start. Below we split the timeseries into 25 segements of 1440 points each, fft each segment then average the 25. We convolve each segment with a Bartlett window.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n\n</span><span class="s1">Try a windowed spectrum (Bartlett window)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1">## windowing -- see p. Numerical recipes 550 for notation</span>

<span class="k">def</span> <span class="nf">calc_window</span><span class="p">(</span><span class="n">numvals</span><span class="o">=</span><span class="mi">1440</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">      Calculate a Bartlett window following</span>
<span class="sd">      Numerical Recipes 13.4.13</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">halfpoint</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">numvals</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span>
    <span class="n">facm</span><span class="o">=</span><span class="n">halfpoint</span>
    <span class="n">facp</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">facm</span>

    <span class="n">window</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">numvals</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">numvals</span><span class="p">):</span>
        <span class="n">window</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="p">((</span><span class="n">j</span> <span class="o">-</span> <span class="n">facm</span><span class="p">)</span><span class="o">*</span><span class="n">facp</span><span class="p">)</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">window</span>

<span class="c1">#</span>
<span class="c1">#  we need to normalize by the squared weights</span>
<span class="c1">#  (see the fortran code on Numerical recipes p. 550)</span>
<span class="c1">#</span>
<span class="n">numvals</span><span class="o">=</span><span class="mi">1440</span>
<span class="n">window</span><span class="o">=</span><span class="n">calc_window</span><span class="p">(</span><span class="n">numvals</span><span class="o">=</span><span class="n">numvals</span><span class="p">)</span>
<span class="n">sumw</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">window</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">numvals</span>
<span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
<span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Bartlett window&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sumw: </span><span class="si">%10.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">sumw</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>



Try a windowed spectrum (Bartlett window)

sumw:      0.533
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/doc_notebooks_lab9_fftnotebook_25_1.png" src="../../_images/doc_notebooks_lab9_fftnotebook_25_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">do_fft</span><span class="p">(</span><span class="n">the_series</span><span class="p">,</span><span class="n">window</span><span class="p">,</span><span class="n">ensemble</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">):</span>
    <span class="n">numvals</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
    <span class="n">sumw</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">window</span><span class="o">**</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">numvals</span>
    <span class="n">subset</span><span class="o">=</span><span class="n">the_series</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">subset</span><span class="o">=</span><span class="n">subset</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">window</span><span class="p">)</span><span class="o">*</span><span class="n">ensemble</span><span class="p">]</span>
    <span class="n">subset</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">subset</span><span class="p">,(</span><span class="n">ensemble</span><span class="p">,</span><span class="n">numvals</span><span class="p">))</span>
    <span class="n">winspec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">numvals</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">therow</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ensemble</span><span class="p">):</span>
        <span class="n">thedat</span><span class="o">=</span><span class="n">subset</span><span class="p">[</span><span class="n">therow</span><span class="p">,:]</span>
        <span class="n">thefft</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">thedat</span><span class="o">*</span><span class="n">window</span><span class="p">)</span>
        <span class="n">Power</span><span class="o">=</span><span class="n">thefft</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">thefft</span><span class="p">)</span>
        <span class="c1">#print(&#39;\nensemble member: %d&#39; % therow)</span>
        <span class="c1">#print(&#39;\nwindowed fft sum (m^2/s^2): %10.4f\n&#39; % (np.sum(Power)/(sumw*numvals**2.),))</span>
        <span class="c1">#print(&#39;velocity variance (m^2/s^2): %10.4f\n\n&#39; % (np.sum(thedat*thedat)/numvals,))</span>
        <span class="n">winspec</span><span class="o">=</span><span class="n">winspec</span> <span class="o">+</span> <span class="n">Power</span>

    <span class="n">winspec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">winspec</span><span class="o">/</span><span class="p">(</span><span class="n">numvals</span><span class="o">**</span><span class="mf">2.</span><span class="o">*</span><span class="n">ensemble</span><span class="o">*</span><span class="n">sumw</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">winspec</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Compare-power-spectra-for-wvel,-theta,-sensible-heat-flux">
<h2>Compare power spectra for wvel, theta, sensible heat flux<a class="headerlink" href="#Compare-power-spectra-for-wvel,-theta,-sensible-heat-flux" title="Permalink to this headline">¶</a></h2>
<div class="section" id="start-with-wvel">
<h3>start with wvel<a class="headerlink" href="#start-with-wvel" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">winspec</span><span class="o">=</span><span class="n">do_fft</span><span class="p">(</span><span class="n">wvel</span><span class="p">,</span><span class="n">window</span><span class="p">)</span>
<span class="n">sampleRate</span><span class="o">=</span><span class="mf">20.833</span>
<span class="n">nyquistfreq</span><span class="o">=</span><span class="n">sampleRate</span><span class="o">/</span><span class="mf">2.</span>
<span class="n">halfpoint</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">winspec</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
<span class="n">averaged_freq</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="n">halfpoint</span><span class="p">)</span><span class="o">*</span><span class="n">nyquistfreq</span>
<span class="n">winspec</span><span class="o">=</span><span class="n">winspec</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">halfpoint</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-15-c9fa25d2f2bd&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>winspec<span class="ansi-blue-fg">=</span>do_fft<span class="ansi-blue-fg">(</span>wvel<span class="ansi-blue-fg">,</span>window<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> sampleRate<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">20.833</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> nyquistfreq<span class="ansi-blue-fg">=</span>sampleRate<span class="ansi-blue-fg">/</span><span class="ansi-cyan-fg">2.</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> halfpoint<span class="ansi-blue-fg">=</span>int<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>winspec<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">/</span><span class="ansi-cyan-fg">2.</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> averaged_freq<span class="ansi-blue-fg">=</span>np<span class="ansi-blue-fg">.</span>linspace<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">1.</span><span class="ansi-blue-fg">,</span>halfpoint<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">*</span>nyquistfreq

<span class="ansi-red-fg">NameError</span>: name &#39;wvel&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">do_plot</span><span class="p">(</span><span class="n">the_freq</span><span class="p">,</span><span class="n">the_spec</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">the_freq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
    <span class="n">the_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">NaN</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">theAx</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">theAx</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">the_freq</span><span class="p">,</span><span class="n">the_spec</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;fft power&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">theAx</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">leftspec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">the_spec</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">halfpoint</span><span class="o">/</span><span class="mf">10.</span><span class="p">))])</span>
    <span class="n">logy</span><span class="o">=</span><span class="n">leftspec</span> <span class="o">-</span> <span class="mf">5.</span><span class="o">/</span><span class="mf">3.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">the_freq</span><span class="p">)</span>
    <span class="n">yvals</span><span class="o">=</span><span class="mf">10.</span><span class="o">**</span><span class="n">logy</span>
    <span class="n">theAx</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">the_freq</span><span class="p">,</span><span class="n">yvals</span><span class="p">,</span><span class="s1">&#39;g-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f^{-5/3}$&#39;</span><span class="p">)</span>
    <span class="n">theAx</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;frequency (Hz)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
        <span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">out</span><span class="o">=</span><span class="n">theAx</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">theAx</span>

<span class="n">labels</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;wvel power spectrum&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$(m^2\,s^{-2}\,Hz^{-1})$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">do_plot</span><span class="p">(</span><span class="n">averaged_freq</span><span class="p">,</span><span class="n">winspec</span><span class="p">,</span><span class="o">**</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-16-89de65363de2&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     17</span>
<span class="ansi-green-intense-fg ansi-bold">     18</span> labels<span class="ansi-blue-fg">=</span>dict<span class="ansi-blue-fg">(</span>title<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;wvel power spectrum&#39;</span><span class="ansi-blue-fg">,</span>ylabel<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;$(m^2\,s^{-2}\,Hz^{-1})$&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 19</span><span class="ansi-red-fg"> </span>ax<span class="ansi-blue-fg">=</span>do_plot<span class="ansi-blue-fg">(</span>averaged_freq<span class="ansi-blue-fg">,</span>winspec<span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">**</span>labels<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;averaged_freq&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">winspec</span><span class="o">=</span><span class="n">do_fft</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="n">window</span><span class="p">)</span>
<span class="n">winspec</span><span class="o">=</span><span class="n">winspec</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">halfpoint</span><span class="p">]</span>
<span class="n">labels</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Temperature power spectrum&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$K^</span><span class="si">{2}</span><span class="s1">\,Hz^{-1})$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">do_plot</span><span class="p">(</span><span class="n">averaged_freq</span><span class="p">,</span><span class="n">winspec</span><span class="p">,</span><span class="o">**</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-17-29f96944eaab&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>winspec<span class="ansi-blue-fg">=</span>do_fft<span class="ansi-blue-fg">(</span>temp<span class="ansi-blue-fg">,</span>window<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> winspec<span class="ansi-blue-fg">=</span>winspec<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>halfpoint<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> labels<span class="ansi-blue-fg">=</span>dict<span class="ansi-blue-fg">(</span>title<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;Temperature power spectrum&#39;</span><span class="ansi-blue-fg">,</span>ylabel<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;$K^{2}\,Hz^{-1})$&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> ax<span class="ansi-blue-fg">=</span>do_plot<span class="ansi-blue-fg">(</span>averaged_freq<span class="ansi-blue-fg">,</span>winspec<span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">**</span>labels<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;temp&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">winspec</span><span class="o">=</span><span class="n">do_fft</span><span class="p">(</span><span class="n">flux</span><span class="p">,</span><span class="n">window</span><span class="p">)</span>
<span class="n">winspec</span><span class="o">=</span><span class="n">winspec</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">halfpoint</span><span class="p">]</span>
<span class="n">labels</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Heat flux power spectrum&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$K m s^{-1}\,Hz^{-1})$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">=</span><span class="n">do_plot</span><span class="p">(</span><span class="n">averaged_freq</span><span class="p">,</span><span class="n">winspec</span><span class="p">,</span><span class="o">**</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-18-4425da1610b2&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>winspec<span class="ansi-blue-fg">=</span>do_fft<span class="ansi-blue-fg">(</span>flux<span class="ansi-blue-fg">,</span>window<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> winspec<span class="ansi-blue-fg">=</span>winspec<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>halfpoint<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> labels<span class="ansi-blue-fg">=</span>dict<span class="ansi-blue-fg">(</span>title<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;Heat flux power spectrum&#39;</span><span class="ansi-blue-fg">,</span>ylabel<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;$K m s^{-1}\,Hz^{-1})$&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> ax<span class="ansi-blue-fg">=</span>do_plot<span class="ansi-blue-fg">(</span>averaged_freq<span class="ansi-blue-fg">,</span>winspec<span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">**</span>labels<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;flux&#39; is not defined
</pre></div></div>
</div>
</div>
</div>
<div class="section" id="Filtering">
<h2>Filtering<a class="headerlink" href="#Filtering" title="Permalink to this headline">¶</a></h2>
<p>We can also filter our timeseries by removing frequencies we aren’t interested in. Numerical Recipes discusses the approach on page 551. For example, suppose we want to filter all frequencies higher than 0.5 Hz from the vertical velocity data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">wvel</span><span class="o">=</span> <span class="n">wvel</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wvel</span><span class="p">)</span>
<span class="n">thefft</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft</span><span class="p">(</span><span class="n">wvel</span><span class="p">)</span>
<span class="n">totsize</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">thefft</span><span class="p">)</span>
<span class="n">samprate</span><span class="o">=</span><span class="mf">20.8333</span> <span class="c1">#Hz</span>
<span class="n">the_time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">totsize</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="mf">20.8333</span><span class="p">)</span>
<span class="n">freq_bin_width</span><span class="o">=</span><span class="n">samprate</span><span class="o">/</span><span class="p">(</span><span class="n">totsize</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
<span class="n">half_hz_index</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span><span class="o">/</span><span class="n">freq_bin_width</span><span class="p">))</span>
<span class="n">filter_func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">thefft</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">filter_func</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">half_hz_index</span><span class="p">]</span><span class="o">=</span><span class="mf">1.</span>
<span class="n">filter_func</span><span class="p">[</span><span class="o">-</span><span class="n">half_hz_index</span><span class="p">:]</span><span class="o">=</span><span class="mf">1.</span>
<span class="n">filtered_wvel</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft</span><span class="p">(</span><span class="n">filter_func</span><span class="o">*</span><span class="n">thefft</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">numpoints</span><span class="o">=</span><span class="mi">500</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">the_time</span><span class="p">[:</span><span class="n">numpoints</span><span class="p">],</span><span class="n">filtered_wvel</span><span class="p">[:</span><span class="n">numpoints</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;filtered&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">the_time</span><span class="p">[:</span><span class="n">numpoints</span><span class="p">],</span><span class="n">wvel</span><span class="p">[:</span><span class="n">numpoints</span><span class="p">],</span><span class="s1">&#39;g+&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;time (seconds)&#39;</span><span class="p">,</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;wvel (m/s)&#39;</span><span class="p">)</span>
<span class="n">out</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-19-666e2342b1f0&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>wvel<span class="ansi-blue-fg">=</span> wvel <span class="ansi-blue-fg">-</span> np<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span>wvel<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> thefft<span class="ansi-blue-fg">=</span>np<span class="ansi-blue-fg">.</span>fft<span class="ansi-blue-fg">.</span>fft<span class="ansi-blue-fg">(</span>wvel<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> totsize<span class="ansi-blue-fg">=</span>len<span class="ansi-blue-fg">(</span>thefft<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> samprate<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">20.8333</span> <span class="ansi-red-fg">#Hz</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> the_time<span class="ansi-blue-fg">=</span>np<span class="ansi-blue-fg">.</span>arange<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span>totsize<span class="ansi-blue-fg">,</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">/</span><span class="ansi-cyan-fg">20.8333</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">NameError</span>: name &#39;wvel&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Numeric project

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>